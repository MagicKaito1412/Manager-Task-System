'use strict';
var path    = require('path');
var chalk   = require('chalk');
var semver = require('semver')

// credits for ascii logo: http://www.chris.com/ascii/index.php?art=animals/reptiles/aligators
var art = chalk.green.bold("" +
"                       .--.  .--.\n" +
"                      /    \\/    \\\n" +
"                     /   .-.  .-. |\n" +
"                    /   |  _\\|  _\\|\n" +
"              .----'    |/` ||/` ||\n" +
"            _/    ,--    \\_0/ \\_0/|\n" +
"         .-'     / `)              \\       .-\"\"\"\"\"\"--.\n" +
"        /          /              .-'-----/           \\\n" +
"       /          /`\\                          () ()  /\n" +
"      /          |   '-.___.                          |\n" +
"     ;           \\      |/ `\\                         /\n" +
"    /             |.---.`.-. '.___              ___.-'\n" +
"  /'              |     \\   \\ \\ |/`'-.,____..-``|/\n" +
"                  \\  ,   \\   \\ \\`,       |/     `\n" +
"                   \\/|    \\   \\ /|       `\n" +
"                    \\/     `   ;-`'.   ,\n" +
"                     `'-.   ,   '.  '-/|    ,\n" +
"                         './|     '-. ``;--/|-.\n" +
"                           '`'--.,___) /|.-'\"` )\n" +
"                      '--._          `\"`    .-'\n" +
"                         .-`'-._          .'\n" +
"                       .'       ``''---''`\n"
);

module.exports = {
	initVersion: function(that) {
		var that = that || this;

		var pkgPath = path.join(__dirname, '../package.json');
		var pkg = that.fs.readJSON(pkgPath);
		that.version = pkg.version;

		// pkg.version is Generator version, e.g. 1.30.4 we need to define dependency for WC 1.30 
		// but not strictly 1.30.4 as it could not exist.
		that.productVersion = semver.major(pkg.version) + "." + semver.minor(pkg.version) + ".0";
		that.productVersionNpmSpec = "~" + that.productVersion;
		that.productVersionBowerSpec = "~" + that.productVersion;

		if (semver.prerelease(pkg.version) != null) {
			// the running generator is prerelease (SHAPSHOT), so release version doesn't exist yet, we'll use tag "next"
			that.productVersionNpmSpec = "next";
			// NOTE: for bower it's ok to use 1.2.3 when only 1.2.3-SNAPSHOT-xx exists (for both repo Artifactory/Git)
		}
	},

	welcome: function(that) {
		var that = that || this;
		if (!that.options || !that.options['skip-logo']) {
		//console.log(that.options);
			that.log(art);
		}

		if (that.productVersion) {
			that.log(
				chalk.yellow("You're running Yeoman generator for ") + chalk.green.bold("CROC") + chalk.yellow(" WebClient ") + 
				chalk.green("v" + that.productVersion));
			that.log(chalk.grey("Generator version v" + that.version + "\n"));
		}
	}
};

